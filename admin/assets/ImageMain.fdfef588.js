import{_ as ee}from"./FormDrawer.bf3acaa6.js";import{a as V,t as I,g as te,e as ae}from"./index.73635d93.js";import{ai as t,o as k,c as z,a as x,M as le,Z as e,T as a,a6 as X,O as Y,r as i,J as ne,a2 as oe,as as Z,U as G,S as D,F as T,aa as H,X as L,Y as K,u as W,p as se,W as ie}from"./@vue.81e65c16.js";function ce(l){return V.get("/admin/image_class/"+l)}function ue(l){return V.post("/admin/image_class",l)}function re(l,c){return V.post("/admin/image_class/"+l,c)}function de(l){return V.post(`/admin/image_class/${l}/delete`)}const _e={class:"truncate"},me={__name:"AsideList",props:{active:{type:Boolean,default:!1}},emits:["edit","delete"],setup(l){return(c,_)=>{const m=t("Edit"),p=t("el-icon"),u=t("el-button"),d=t("Close"),g=t("el-popconfirm");return k(),z("div",{class:Y(["aside-list",{active:l.active}])},[x("span",_e,[le(c.$slots,"default")]),e(u,{class:"ml-auto px-1",text:"",type:"primary",size:"small",onClick:_[0]||(_[0]=X(f=>c.$emit("edit"),["stop"]))},{default:a(()=>[e(p,{size:12},{default:a(()=>[e(m)]),_:1})]),_:1}),x("span",{onClick:_[2]||(_[2]=X(()=>{},["stop"]))},[e(g,{title:"\u662F\u5426\u8981\u5220\u9664\u8BE5\u5206\u7C7B\uFF1F",confirmButtonText:"\u786E\u8BA4",cancelButtonText:"\u53D6\u6D88",onConfirm:_[1]||(_[1]=f=>c.$emit("delete"))},{reference:a(()=>[e(u,{text:"",class:"px-1",type:"primary",size:"small"},{default:a(()=>[e(p,{size:12},{default:a(()=>[e(d)]),_:1})]),_:1})]),_:1})])],2)}}};const pe={class:"top"},fe={class:"bottom"},Be={__name:"ImageAside",emits:["change"],setup(l,{expose:c,emit:_}){const m=i(!1),p=i([]),u=i(1),d=i(0),g=i(10);function f(n=null){typeof n=="number"&&(u.value=n),m.value=!0,ce(u.value).then(y=>{d.value=y.totalCount,p.value=y.list;let w=p.value[0];w&&h(w.id)}).finally(()=>{m.value=!1})}f();const v=i(0),b=ne(()=>v.value?"\u4FEE\u6539":"\u65B0\u589E"),$=i(null),s=oe({name:"",order:50}),A={name:[{required:!0,message:"\u56FE\u5E93\u5206\u7C7B\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]},B=i(null),F=()=>{B.value.validate(n=>{if(!n)return;$.value.showLoading(),(v.value?re(v.value,s):ue(s)).then(w=>{I(b.value+"\u6210\u529F"),f(v.value?u.value:1),$.value.close()}).finally(()=>{$.value.hideLoading()})})},N=()=>{v.value=0,s.name="",s.order=50,$.value.open()},S=n=>{v.value=n.id,s.name=n.name,s.order=n.order,$.value.open()},M=n=>{m.value=!0,de(n).then(y=>{I("\u5220\u9664\u6210\u529F"),f()}).finally(()=>{m.value=!1})},o=i(0);function h(n){o.value=n,_("change",n)}return c({handleCreate:N}),(n,y)=>{const w=t("el-pagination"),R=t("el-aside"),j=t("el-input"),U=t("el-form-item"),O=t("el-input-number"),P=t("el-form"),J=Z("loading");return k(),z(T,null,[G((k(),D(R,{width:"220px",class:"image-aside"},{default:a(()=>[x("div",pe,[(k(!0),z(T,null,H(p.value,(C,q)=>(k(),D(me,{active:o.value==C.id,key:q,onEdit:r=>S(C),onDelete:r=>M(C.id),onClick:r=>h(C.id)},{default:a(()=>[L(K(C.name),1)]),_:2},1032,["active","onEdit","onDelete","onClick"]))),128))]),x("div",fe,[e(w,{background:"",layout:"prev, next",total:d.value,"current-page":u.value,"page-size":g.value,onCurrentChange:f},null,8,["total","current-page","page-size"])])]),_:1})),[[J,m.value]]),e(ee,{title:W(b),ref_key:"formDrawerRef",ref:$,onSubmit:F},{default:a(()=>[e(P,{model:s,ref_key:"formRef",ref:B,rules:A,"label-width":"80px",inline:!1},{default:a(()=>[e(U,{label:"\u5206\u7C7B\u540D\u79F0",prop:"name"},{default:a(()=>[e(j,{modelValue:s.name,"onUpdate:modelValue":y[0]||(y[0]=C=>s.name=C)},null,8,["modelValue"])]),_:1}),e(U,{label:"\u6392\u5E8F",prop:"order"},{default:a(()=>[e(O,{modelValue:s.order,"onUpdate:modelValue":y[1]||(y[1]=C=>s.order=C),min:0,max:1e3},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])],64)}}};function ve(l,c=1){return V.get(`/admin/image_class/${l}/image/${c}`)}function ge(l,c){return V.post(`/admin/image/${l}`,{name:c})}function he(l){return V.post("/admin/image/delete_all",{ids:l})}const ye="http://ceshi13.dishait.cn/admin/image/upload",Ce=x("div",{class:"el-upload__text"},[L(" Drop file here or "),x("em",null,"click to upload")],-1),ke=x("div",{class:"el-upload__tip"}," jpg/png files with a size less than 500kb ",-1),xe={__name:"UploadFile",props:{data:Object},emits:["success"],setup(l,{emit:c}){const _=te(),m=(u,d,g)=>{console.log(u),c("success",{response:u,uploadFile:d,uploadFiles:g})},p=(u,d,g)=>{let f=JSON.parse(u.message).msg||"\u4E0A\u4F20\u5931\u8D25";I(f,"error")};return(u,d)=>{const g=t("upload-filled"),f=t("el-icon"),v=t("el-upload");return k(),D(v,{drag:"",action:W(ye),multiple:"",headers:{token:W(_)},name:"img",data:l.data,"on-success":m,"on-error":p},{tip:a(()=>[ke]),default:a(()=>[e(f,{class:"el-icon--upload"},{default:a(()=>[e(g)]),_:1}),Ce]),_:1},8,["action","headers","data"])}}};const be={class:"top p-3"},$e={class:"image-title"},we={class:"flex items-center justify-center p-2"},Ve={class:"bottom"},Se={__name:"ImageMain",props:{openChoose:{type:Boolean,default:!1},limit:{type:Number,default:1}},emits:["choose"],setup(l,{expose:c,emit:_}){const m=l,p=i(!1),u=()=>p.value=!0,d=i(1),g=i(0),f=i(10),v=i([]),b=i(!1),$=i(0);function s(o=null){typeof o=="number"&&(d.value=o),b.value=!0,ve($.value,d.value).then(h=>{g.value=h.totalCount,v.value=h.list.map(n=>(n.checked=!1,n))}).finally(()=>{b.value=!1})}const A=o=>{d.value=1,$.value=o,s()},B=o=>{ae("\u91CD\u547D\u540D",o.name).then(({value:h})=>{b.value=!0,ge(o.id,h).then(n=>{I("\u4FEE\u6539\u6210\u529F"),s()}).finally(()=>{b.value=!1})})},F=o=>{b.value=!0,he([o]).then(h=>{I("\u5220\u9664\u6210\u529F"),s()}).finally(()=>{b.value=!1})},N=()=>s(1),S=se(()=>v.value.filter(o=>o.checked)),M=o=>{if(o.checked&&S.value.length>m.limit)return o.checked=!1,I(`\u6700\u591A\u53EA\u80FD\u9009\u4E2D${m.limit}\u5F20`,"error");_("choose",S.value)};return c({loadData:A,openUploadFile:u}),(o,h)=>{const n=t("el-image"),y=t("el-checkbox"),w=t("el-button"),R=t("el-popconfirm"),j=t("el-card"),U=t("el-col"),O=t("el-row"),P=t("el-pagination"),J=t("el-main"),C=t("el-drawer"),q=Z("loading");return k(),z(T,null,[G((k(),D(J,{class:"image-main"},{default:a(()=>[x("div",be,[e(O,{gutter:10},{default:a(()=>[(k(!0),z(T,null,H(v.value,(r,Q)=>(k(),D(U,{span:6,offset:0,key:Q},{default:a(()=>[e(j,{shadow:"hover",class:Y(["relative mb-3",{"border-blue-500":r.checked}]),"body-style":{padding:0}},{default:a(()=>[e(n,{src:r.url,fit:"cover",class:"h-[150px]",style:{width:"100%"},"preview-src-list":[r.url],"initial-index":0},null,8,["src","preview-src-list"]),x("div",$e,K(r.name),1),x("div",we,[l.openChoose?(k(),D(y,{key:0,modelValue:r.checked,"onUpdate:modelValue":E=>r.checked=E,onChange:E=>M(r)},null,8,["modelValue","onUpdate:modelValue","onChange"])):ie("",!0),e(w,{type:"primary",size:"small",text:"",onClick:E=>B(r)},{default:a(()=>[L("\u91CD\u547D\u540D")]),_:2},1032,["onClick"]),e(R,{title:"\u662F\u5426\u5220\u9664\u8BE5\u56FE\u7247\uFF1F",confirmButtonText:"\u786E\u8BA4",cancelButtonText:"\u53D6\u6D88",onConfirm:E=>F(r.id)},{reference:a(()=>[e(w,{class:"!m-0",type:"primary",size:"small",text:""},{default:a(()=>[L("\u5220\u9664")]),_:1})]),_:2},1032,["onConfirm"])])]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})]),x("div",Ve,[e(P,{background:"",layout:"prev,pager, next",total:g.value,"current-page":d.value,"page-size":f.value,onCurrentChange:s},null,8,["total","current-page","page-size"])])]),_:1})),[[q,b.value]]),e(C,{modelValue:p.value,"onUpdate:modelValue":h[0]||(h[0]=r=>p.value=r),title:"\u4E0A\u4F20\u56FE\u7247"},{default:a(()=>[e(xe,{data:{image_class_id:$.value},onSuccess:N},null,8,["data"])]),_:1},8,["modelValue"])],64)}}};export{Be as _,Se as a};
