import{_ as ae}from"./ListHeader.3c627458.js";import{_ as T}from"./FormDrawer.bf3acaa6.js";import{a as p,t as oe}from"./index.73635d93.js";import{g as ne}from"./rule.f107400a.js";import{u as re,a as se}from"./useCommon.39802c06.js";import{r as u,ai as n,as as ie,o as $,S as L,T as l,Z as e,u as t,U as ue,X as v,a as k,Y as z}from"./@vue.81e65c16.js";import"./element-plus.aff2968d.js";import"./lodash-es.759d0354.js";import"./@vueuse.d6949a36.js";import"./universal-cookie.9008d64e.js";import"./cookie.ccf51230.js";import"./@element-plus.0ddfaa13.js";import"./@popperjs.36402333.js";import"./@ctrl.b082b0c1.js";import"./dayjs.8ff0c08c.js";import"./axios.23bc5756.js";import"./async-validator.fb49d0f5.js";import"./memoize-one.4ee5c96d.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.8aeb3683.js";import"./@floating-ui.4bc9703a.js";import"./vue-router.fe3267df.js";import"./vuex.5f15401c.js";import"./nprogress.18e92d20.js";function de(o){return p.get(`/admin/role/${o}`)}function me(o){return p.post("/admin/role",o)}function ce(o,d){return p.post("/admin/role/"+o,d)}function pe(o){return p.post(`/admin/role/${o}/delete`)}function fe(o,d){return p.post(`/admin/role/${o}/update_status`,{status:d})}function _e(o,d){return p.post("/admin/role/set_rules",{id:o,rule_ids:d})}const he={class:"flex items-center justify-center mt-5"},ve={class:"flex items-center"},ge={class:"ml-2 text-sm"},Pe={__name:"list",setup(o){const{tableData:d,loading:B,currentPage:I,total:K,limit:U,getData:_,handleDelete:F,handleStatusChange:N}=re({getList:de,delete:pe,updateStatus:fe}),{formDrawerRef:E,formRef:H,form:m,rules:j,drawerTitle:q,handleSubmit:P,handleCreate:X,handleEdit:Y}=se({form:{name:"",desc:"",status:1},rules:{name:[{required:!0,message:"\u89D2\u8272\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]},getData:_,update:ce,create:me}),f=u(null),C=u([]),R=u(0),w=u(0),x=u([]),V=u(null),h=u([]),g=u(!1),Z=c=>{w.value=c.id,R.value=window.innerHeight-180,g.value=!0,ne(1).then(r=>{C.value=r.list,x.value=r.list.map(s=>s.id),f.value.open(),h.value=c.rules.map(s=>s.id),setTimeout(()=>{V.value.setCheckedKeys(h.value),g.value=!1},150)})},A=()=>{f.value.showLoading(),_e(w.value,h.value).then(c=>{oe("\u914D\u7F6E\u6210\u529F"),_(),f.value.close()}).finally(()=>{f.value.hideLoading()})},G=(...c)=>{const{checkedKeys:r,halfCheckedKeys:s}=c[1];h.value=[...r,...s]};return(c,r)=>{const s=n("el-table-column"),S=n("el-switch"),b=n("el-button"),J=n("el-popconfirm"),M=n("el-table"),O=n("el-pagination"),D=n("el-input"),y=n("el-form-item"),Q=n("el-form"),W=n("el-tag"),ee=n("el-tree-v2"),te=n("el-card"),le=ie("loading");return $(),L(te,{shadow:"never",class:"border-0"},{default:l(()=>[e(ae,{onCreate:t(X),onRefresh:t(_)},null,8,["onCreate","onRefresh"]),ue(($(),L(M,{data:t(d),stripe:"",style:{width:"100%"}},{default:l(()=>[e(s,{prop:"name",label:"\u89D2\u8272\u540D\u79F0"}),e(s,{prop:"desc",label:"\u89D2\u8272\u63CF\u8FF0",width:"380"}),e(s,{label:"\u72B6\u6001",width:"120"},{default:l(({row:a})=>[e(S,{modelValue:a.status,"active-value":1,"inactive-value":0,loading:a.statusLoading,disabled:a.super==1,onChange:i=>t(N)(i,a)},null,8,["modelValue","loading","disabled","onChange"])]),_:1}),e(s,{label:"\u64CD\u4F5C",width:"250",align:"center"},{default:l(a=>[e(b,{type:"primary",size:"small",text:"",onClick:i=>Z(a.row)},{default:l(()=>[v("\u914D\u7F6E\u6743\u9650")]),_:2},1032,["onClick"]),e(b,{type:"primary",size:"small",text:"",onClick:i=>t(Y)(a.row)},{default:l(()=>[v("\u4FEE\u6539")]),_:2},1032,["onClick"]),e(J,{title:"\u662F\u5426\u8981\u5220\u9664\u8BE5\u516C\u544A\uFF1F",confirmButtonText:"\u786E\u8BA4",cancelButtonText:"\u53D6\u6D88",onConfirm:i=>t(F)(a.row.id)},{reference:l(()=>[e(b,{text:"",type:"primary",size:"small"},{default:l(()=>[v("\u5220\u9664")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[le,t(B)]]),k("div",he,[e(O,{background:"",layout:"prev, pager ,next",total:t(K),"current-page":t(I),"page-size":t(U),onCurrentChange:t(_)},null,8,["total","current-page","page-size","onCurrentChange"])]),e(T,{ref_key:"formDrawerRef",ref:E,title:t(q),onSubmit:t(P)},{default:l(()=>[e(Q,{model:t(m),ref_key:"formRef",ref:H,rules:t(j),"label-width":"80px",inline:!1},{default:l(()=>[e(y,{label:"\u89D2\u8272\u540D\u79F0",prop:"name"},{default:l(()=>[e(D,{modelValue:t(m).name,"onUpdate:modelValue":r[0]||(r[0]=a=>t(m).name=a),placeholder:"\u89D2\u8272\u540D\u79F0"},null,8,["modelValue"])]),_:1}),e(y,{label:"\u89D2\u8272\u63CF\u8FF0",prop:"desc"},{default:l(()=>[e(D,{modelValue:t(m).desc,"onUpdate:modelValue":r[1]||(r[1]=a=>t(m).desc=a),placeholder:"\u89D2\u8272\u63CF\u8FF0",type:"textarea",rows:5},null,8,["modelValue"])]),_:1}),e(y,{label:"\u72B6\u6001",prop:"status"},{default:l(()=>[e(S,{modelValue:t(m).status,"onUpdate:modelValue":r[2]||(r[2]=a=>t(m).status=a),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","onSubmit"]),e(T,{ref_key:"setRuleFormDrawerRef",ref:f,title:"\u6743\u9650\u914D\u7F6E",onSubmit:A},{default:l(()=>[e(ee,{ref_key:"elTreeRef",ref:V,"node-key":"id","check-strictly":g.value,"default-expanded-keys":x.value,data:C.value,props:{label:"name",children:"child"},"show-checkbox":"",height:R.value,onCheck:G},{default:l(({node:a,data:i})=>[k("div",ve,[e(W,{type:i.menu?"":"info",size:"small"},{default:l(()=>[v(z(i.menu?"\u83DC\u5355":"\u6743\u9650"),1)]),_:2},1032,["type"]),k("span",ge,z(i.name),1)])]),_:1},8,["check-strictly","default-expanded-keys","data","height"])]),_:1},512)]),_:1})}}};export{Pe as default};
