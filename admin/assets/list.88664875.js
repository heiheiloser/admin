import{_ as ae}from"./ListHeader.3c627458.js";import{_ as ne,a as j}from"./SearchItem.584b0c12.js";import{q as Z,a as N,t as G,s as oe,e as se}from"./index.73635d93.js";import{r as M,a2 as de,ai as d,o as m,S as g,T as e,Z as t,c as D,F as T,aa as A,X as i,a as s,Y as u,p as X,u as o,W as E,as as ie,U as re}from"./@vue.81e65c16.js";import{s as ue}from"./@vueuse.d6949a36.js";import{u as me}from"./useCommon.39802c06.js";import"./element-plus.aff2968d.js";import"./lodash-es.759d0354.js";import"./@element-plus.0ddfaa13.js";import"./@popperjs.36402333.js";import"./@ctrl.b082b0c1.js";import"./dayjs.8ff0c08c.js";import"./axios.23bc5756.js";import"./async-validator.fb49d0f5.js";import"./memoize-one.4ee5c96d.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.8aeb3683.js";import"./@floating-ui.4bc9703a.js";import"./vue-router.fe3267df.js";import"./vuex.5f15401c.js";import"./nprogress.18e92d20.js";import"./universal-cookie.9008d64e.js";import"./cookie.ccf51230.js";function ce(l,v={}){let p=Z(v);return N.get(`/admin/order/${l}${p}`)}function _e(l){return N.post("/admin/order/delete_all",{ids:l})}function pe(l={}){let v=Z(l);return N.post(`/admin/order/excelexport${v}`,{},{responseType:"blob"})}function fe(l){return N.get(`/admin/order/${l}/get_ship_info`)}function be(l,v){return N.post(`/admin/order/${l}/handle_refund`,v)}const he={__name:"ExportExcel",props:{tabs:Array},setup(l,{expose:v}){const p=M(!1),C=()=>p.value=!0,c=()=>p.value=!1,_=de({tab:null,time:""}),f=M(!1),U=()=>{if(!_.tab)return G("\u8BA2\u5355\u7C7B\u578B\u4E0D\u80FD\u4E3A\u7A7A","error");f.value=!0;let k=null,b=null;_.time&&Array.isArray(_.time)&&(k=_.time[0],b=_.time[1]),pe({tab:_.tab,starttime:k,endtime:b}).then(x=>{let h=window.URL.createObjectURL(new Blob([x])),r=document.createElement("a");r.style.display="none",r.href=h;let V=new Date().getTime()+".xlsx";r.setAttribute("download",V),document.body.appendChild(r),r.click(),c()}).finally(()=>{f.value=!1})};return v({open:C}),(k,b)=>{const x=d("el-option"),h=d("el-select"),r=d("el-form-item"),V=d("el-date-picker"),z=d("el-button"),I=d("el-form"),F=d("el-drawer");return m(),g(F,{title:"\u5BFC\u51FA\u8BA2\u5355",modelValue:p.value,"onUpdate:modelValue":b[2]||(b[2]=y=>p.value=y),size:"40%"},{default:e(()=>[t(I,{model:_,"label-width":"80px"},{default:e(()=>[t(r,{label:"\u8BA2\u5355\u7C7B\u578B"},{default:e(()=>[t(h,{modelValue:_.tab,"onUpdate:modelValue":b[0]||(b[0]=y=>_.tab=y),placeholder:"\u8BF7\u9009\u62E9"},{default:e(()=>[(m(!0),D(T,null,A(l.tabs,y=>(m(),g(x,{key:y.key,label:y.name,value:y.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(r,{label:"\u65F6\u95F4\u8303\u56F4"},{default:e(()=>[t(V,{modelValue:_.time,"onUpdate:modelValue":b[1]||(b[1]=y=>_.time=y),type:"daterange","range-separator":"\u81F3","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),t(r,null,{default:e(()=>[t(z,{type:"primary",onClick:U,loading:f.value},{default:e(()=>[i("\u5BFC\u51FA")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}},ye={class:"flex items-center"},ge={class:"ml-3"},ve={__name:"ShipInfoModal",setup(l,{expose:v}){const p=M(!1),C=M({});return v({open:_=>fe(_).then(f=>{if(f.status!=0)return G(f.msg,"error");C.value=f.result,console.log(f.result),p.value=!0})}),(_,f)=>{const U=d("el-image"),k=d("el-card"),b=d("el-timeline-item"),x=d("el-timeline"),h=d("el-drawer");return m(),g(h,{title:"\u7269\u6D41\u4FE1\u606F",modelValue:p.value,"onUpdate:modelValue":f[0]||(f[0]=r=>p.value=r),size:"40%"},{default:e(()=>[t(k,{shadow:"never",class:"border-0 mb-3"},{default:e(()=>[s("div",ye,[t(U,{src:C.value.logo,fit:"fill",lazy:!0,style:{width:"60px",height:"60px"},class:"rounded border"},null,8,["src"]),s("div",ge,[s("p",null,"\u7269\u6D41\u516C\u53F8\uFF1A"+u(C.value.typename),1),s("p",null,"\u7269\u6D41\u5355\u53F7\uFF1A"+u(C.value.number),1)])])]),_:1}),t(k,{shadow:"never",class:"border-0 border-t"},{default:e(()=>[t(x,{class:"ml-[-40px]"},{default:e(()=>[(m(!0),D(T,null,A(C.value.list,(r,V)=>(m(),g(b,{timestamp:r.time,placement:"top",key:V},{default:e(()=>[i(u(r.status),1)]),_:2},1032,["timestamp"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])}}},xe=s("b",{class:"text-sm"},"\u8BA2\u5355\u8BE6\u60C5",-1),ke=s("b",{class:"text-sm"},"\u53D1\u8D27\u4FE1\u606F",-1),Ve=s("b",{class:"text-sm"},"\u5546\u54C1\u4FE1\u606F",-1),we={class:"ml-2 text-sm"},Ce={key:0,class:"mt-1"},$e={class:"text-rose-500 mr-2"},ze={class:"text-xs text-gray-500"},De={class:"text-rose-500 font-bold"},Me=s("b",{class:"text-sm"},"\u6536\u8D27\u4FE1\u606F",-1),Ye=s("b",{class:"text-sm"},"\u9000\u6B3E\u4FE1\u606F",-1),Se={__name:"InfoModal",props:{info:Object},setup(l,{expose:v}){const p=l,C=X(()=>p.info.ship_data?ue(p.info.ship_data.express_time*1e3,"YYYY-MM-DD HH:mm:ss").value:""),c=X(()=>{const x={pending:"\u672A\u9000\u6B3E",applied:"\u5DF2\u7533\u8BF7\uFF0C\u7B49\u5F85\u5BA1\u6838",processing:"\u9000\u6B3E\u4E2D",success:"\u9000\u6B3E\u6210\u529F",failed:"\u9000\u6B3E\u5931\u8D25"};return p.info.refund_status?x[p.info.refund_status]:""}),_=M(!1),f=()=>{_.value=!0,console.log(p.info)},U=M(null),k=M(!1),b=x=>{k.value=!0,U.value.open(x).finally(()=>k.value=!1)};return v({open:f}),(x,h)=>{const r=d("el-form-item"),V=d("el-form"),z=d("el-card"),I=d("el-button"),F=d("el-image"),y=d("el-tag"),P=d("el-drawer");return m(),D(T,null,[t(P,{title:"\u8BA2\u5355\u8BE6\u60C5",modelValue:_.value,"onUpdate:modelValue":h[1]||(h[1]=$=>_.value=$),size:"50%"},{default:e(()=>[t(z,{shadow:"never",class:"mb-3"},{header:e(()=>[xe]),default:e(()=>[t(V,{"label-width":"80px"},{default:e(()=>[t(r,{label:"\u8BA2\u5355\u53F7"},{default:e(()=>[i(u(l.info.no),1)]),_:1}),t(r,{label:"\u4ED8\u6B3E\u65B9\u5F0F"},{default:e(()=>[i(u(l.info.payment_method),1)]),_:1}),t(r,{label:"\u4ED8\u6B3E\u65F6\u95F4"},{default:e(()=>[i(u(l.info.paid_time),1)]),_:1}),t(r,{label:"\u521B\u5EFA\u65F6\u95F4"},{default:e(()=>[i(u(l.info.create_time),1)]),_:1})]),_:1})]),_:1}),l.info.ship_data?(m(),g(z,{key:0,shadow:"never",class:"mb-3"},{header:e(()=>[ke]),default:e(()=>[t(V,{"label-width":"80px"},{default:e(()=>[t(r,{label:"\u7269\u6D41\u516C\u53F8"},{default:e(()=>[i(u(l.info.ship_data.express_company),1)]),_:1}),t(r,{label:"\u8FD0\u5355\u53F7"},{default:e(()=>[i(u(l.info.ship_data.express_no)+" ",1),t(I,{type:"primary",text:"",size:"small",onClick:h[0]||(h[0]=$=>b(l.info.id)),class:"ml-3",loading:k.value},{default:e(()=>[i("\u67E5\u770B\u7269\u6D41")]),_:1},8,["loading"])]),_:1}),t(r,{label:"\u53D1\u8D27\u65F6\u95F4"},{default:e(()=>[i(u(o(C)),1)]),_:1})]),_:1})]),_:1})):E("",!0),t(z,{shadow:"never",class:"mb-3"},{header:e(()=>[Ve]),default:e(()=>[(m(!0),D(T,null,A(l.info.order_items,($,q)=>{var w,n,Y,S;return m(),D("div",{class:"flex mb-2",key:q},[t(F,{src:(n=(w=$.goods_item)==null?void 0:w.cover)!=null?n:"",fit:"fill",lazy:!0,style:{width:"60px",height:"60px"}},null,8,["src"]),s("div",we,[s("p",null,u((S=(Y=$.goods_item)==null?void 0:Y.title)!=null?S:"\u5546\u54C1\u5DF2\u88AB\u5220\u9664"),1),$.sku?(m(),D("p",Ce,[t(y,{type:"info",size:"small"},{default:e(()=>[i(u($.sku),1)]),_:2},1024)])):E("",!0),s("p",null,[s("b",$e,"\uFFE5"+u($.price),1),s("span",ze,"x"+u($.num),1)])])])}),128)),t(V,{"label-width":"80px"},{default:e(()=>[t(r,{label:"\u6210\u4EA4\u4EF7"},{default:e(()=>[s("span",De,"\uFFE5"+u(l.info.total_price),1)]),_:1})]),_:1})]),_:1}),l.info.address?(m(),g(z,{key:1,shadow:"never",class:"mb-3"},{header:e(()=>[Me]),default:e(()=>[t(V,{"label-width":"80px"},{default:e(()=>[t(r,{label:"\u6536\u8D27\u4EBA"},{default:e(()=>[i(u(l.info.address.name),1)]),_:1}),t(r,{label:"\u8054\u7CFB\u65B9\u5F0F"},{default:e(()=>[i(u(l.info.address.phone),1)]),_:1}),t(r,{label:"\u6536\u8D27\u5730\u5740"},{default:e(()=>[i(u(l.info.address.province+l.info.address.city+l.info.address.district+l.info.address.address),1)]),_:1})]),_:1})]),_:1})):E("",!0),l.info.refund_status!="pending"?(m(),g(z,{key:2,shadow:"never"},{header:e(()=>[Ye,t(I,{text:"",disabled:"",style:{float:"right"}},{default:e(()=>[i(u(o(c)),1)]),_:1})]),default:e(()=>[t(V,{"label-width":"80px"},{default:e(()=>[t(r,{label:"\u9000\u6B3E\u7406\u7531"},{default:e(()=>[i(u(l.info.extra.refund_reason),1)]),_:1})]),_:1})]),_:1})):E("",!0)]),_:1},8,["modelValue"]),t(ve,{ref_key:"ShipInfoModalRef",ref:U},null,512)],64)}}},Re={class:"flex text-sm"},Ue={class:"flex-1"},Ie=s("p",null,"\u8BA2\u5355\u53F7\uFF1A",-1),Ee=s("p",null,"\u4E0B\u5355\u65F6\u95F4\uFF1A",-1),Le={class:"text-blue-500 ml-2"},Te={class:"flex items-center justify-center mt-5"},dt={__name:"list",setup(l){const{handleSelectionChange:v,multipleTableRef:p,handleMultiDelete:C,searchForm:c,resetSearchForm:_,tableData:f,loading:U,currentPage:k,total:b,limit:x,getData:h,handleDelete:r,multiSelectionIds:V}=me({searchForm:{no:"",tab:"all",starttime:"",endtime:"",name:"",phone:""},getList:ce,onGetListSuccess:w=>{f.value=w.list.map(n=>(n.bannersLoading=!1,n.contentLoading=!1,n.skusLoading=!1,n)),b.value=w.totalCount},delete:_e}),z=[{key:"all",name:"\u5168\u90E8"},{key:"nopay",name:"\u5F85\u652F\u4ED8"},{key:"noship",name:"\u5F85\u53D1\u8D27"},{key:"shiped",name:"\u5F85\u6536\u8D27"},{key:"received",name:"\u5DF2\u6536\u8D27"},{key:"finish",name:"\u5DF2\u5B8C\u6210"},{key:"closed",name:"\u5DF2\u5173\u95ED"},{key:"refunding",name:"\u9000\u6B3E\u4E2D"}],I=M(null),F=()=>I.value.open(),y=M(null),P=M(null),$=w=>{w.order_items=w.order_items.map(n=>{if(n.skus_type==1&&n.goods_skus){let Y=[];for(const S in n.goods_skus.skus)Y.push(n.goods_skus.skus[S].value);n.sku=Y.join(",")}return n}),P.value=w,y.value.open()},q=(w,n)=>{(n?oe("\u662F\u5426\u8981\u540C\u610F\u8BE5\u8BA2\u5355\u9000\u6B3E?"):se("\u8BF7\u8F93\u5165\u62D2\u7EDD\u7684\u7406\u7531")).then(({value:Y})=>{let S={agree:n};n||(S.disagree_reason=Y),be(w,S).then(H=>{h(),G("\u64CD\u4F5C\u6210\u529F")})})};return(w,n)=>{const Y=d("el-tab-pane"),S=d("el-tabs"),H=d("el-input"),W=d("el-date-picker"),O=d("el-button"),L=d("el-table-column"),J=d("el-image"),B=d("el-tag"),K=d("el-table"),Q=d("el-pagination"),ee=d("el-card"),te=ie("loading");return m(),D("div",null,[t(S,{modelValue:o(c).tab,"onUpdate:modelValue":n[0]||(n[0]=a=>o(c).tab=a),onTabChange:o(h)},{default:e(()=>[(m(),D(T,null,A(z,(a,R)=>t(Y,{label:a.name,name:a.key,key:R},null,8,["label","name"])),64))]),_:1},8,["modelValue","onTabChange"]),t(ee,{shadow:"never",class:"border-0"},{default:e(()=>[t(ne,{model:o(c),onSearch:o(h),onReset:o(_)},{show:e(()=>[t(j,{label:"\u6536\u8D27\u4EBA"},{default:e(()=>[t(H,{modelValue:o(c).name,"onUpdate:modelValue":n[2]||(n[2]=a=>o(c).name=a),placeholder:"\u6536\u8D27\u4EBA",clearable:""},null,8,["modelValue"])]),_:1}),t(j,{label:"\u624B\u673A\u53F7"},{default:e(()=>[t(H,{modelValue:o(c).phone,"onUpdate:modelValue":n[3]||(n[3]=a=>o(c).phone=a),placeholder:"\u624B\u673A\u53F7",clearable:""},null,8,["modelValue"])]),_:1}),t(j,{label:"\u5F00\u59CB\u65F6\u95F4"},{default:e(()=>[t(W,{modelValue:o(c).starttime,"onUpdate:modelValue":n[4]||(n[4]=a=>o(c).starttime=a),type:"date",placeholder:"\u5F00\u59CB\u65E5\u671F",style:{width:"90%"},"value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),t(j,{label:"\u7ED3\u675F\u65F6\u95F4"},{default:e(()=>[t(W,{modelValue:o(c).endtime,"onUpdate:modelValue":n[5]||(n[5]=a=>o(c).endtime=a),type:"date",placeholder:"\u7ED3\u675F\u65E5\u671F",style:{width:"90%"},"value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),default:e(()=>[t(j,{label:"\u8BA2\u5355\u7F16\u53F7"},{default:e(()=>[t(H,{modelValue:o(c).no,"onUpdate:modelValue":n[1]||(n[1]=a=>o(c).no=a),placeholder:"\u8BA2\u5355\u7F16\u53F7",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","onSearch","onReset"]),t(ae,{layout:"refresh,download",onRefresh:o(h),onDownload:F},{default:e(()=>[t(O,{type:"danger",size:"small",onClick:o(C)},{default:e(()=>[i("\u6279\u91CF\u5220\u9664")]),_:1},8,["onClick"])]),_:1},8,["onRefresh"]),re((m(),g(K,{ref_key:"multipleTableRef",ref:p,onSelectionChange:o(v),data:o(f),stripe:"",style:{width:"100%"}},{default:e(()=>[t(L,{type:"selection",width:"55"}),t(L,{label:"\u5546\u54C1",width:"300"},{default:e(({row:a})=>[s("div",null,[s("div",Re,[s("div",Ue,[Ie,s("small",null,u(a.no),1)]),s("div",null,[Ee,s("small",null,u(a.create_time),1)])]),(m(!0),D(T,null,A(a.order_items,(R,le)=>(m(),D("div",{class:"flex py-2",key:le},[t(J,{src:R.goods_item?R.goods_item.cover:"",fit:"cover",lazy:!0,style:{width:"30px",height:"30px"}},null,8,["src"]),s("p",Le,u(R.goods_item?R.goods_item.title:"\u5546\u54C1\u5DF2\u88AB\u5220\u9664"),1)]))),128))])]),_:1}),t(L,{label:"\u5B9E\u9645\u4ED8\u6B3E",width:"120",prop:"total_price",align:"center"}),t(L,{align:"center",label:"\u4E70\u5BB6",width:"120"},{default:e(({row:a})=>[s("p",null,u(a.user.nickname||a.user.username),1),s("small",null,"(\u7528\u6237ID\uFF1A"+u(a.user.id)+")",1)]),_:1}),t(L,{label:"\u4EA4\u6613\u72B6\u6001",width:"170",align:"center"},{default:e(({row:a})=>[s("div",null,[i(" \u4ED8\u6B3E\u72B6\u6001\uFF1A "),a.payment_method=="wechat"?(m(),g(B,{key:0,type:"success",size:"small"},{default:e(()=>[i("\u5FAE\u4FE1\u652F\u4ED8")]),_:1})):a.payment_method=="alipay"?(m(),g(B,{key:1,size:"small"},{default:e(()=>[i("\u652F\u4ED8\u5B9D\u652F\u4ED8")]),_:1})):(m(),g(B,{key:2,type:"info",size:"small"},{default:e(()=>[i("\u672A\u652F\u4ED8")]),_:1}))]),s("div",null,[i(" \u53D1\u8D27\u72B6\u6001\uFF1A "),t(B,{type:a.ship_data?"success":"info",size:"small"},{default:e(()=>[i(u(a.ship_data?"\u5DF2\u53D1\u8D27":"\u672A\u53D1\u8D27"),1)]),_:2},1032,["type"])]),s("div",null,[i(" \u6536\u8D27\u72B6\u6001\uFF1A "),t(B,{type:a.ship_status=="received"?"success":"info",size:"small"},{default:e(()=>[i(u(a.ship_status=="received"?"\u5DF2\u6536\u8D27":"\u672A\u6536\u8D27"),1)]),_:2},1032,["type"])])]),_:1}),t(L,{label:"\u64CD\u4F5C",align:"center"},{default:e(({row:a})=>[t(O,{class:"px-1",type:"primary",size:"small",text:"",onClick:R=>$(a)},{default:e(()=>[i("\u8BA2\u5355\u8BE6\u60C5")]),_:2},1032,["onClick"]),o(c).tab==="noship"?(m(),g(O,{key:0,class:"px-1",type:"primary",size:"small",text:""},{default:e(()=>[i("\u8BA2\u5355\u53D1\u8D27")]),_:1})):E("",!0),o(c).tab==="refunding"?(m(),g(O,{key:1,class:"px-1",type:"primary",size:"small",text:"",onClick:R=>q(a.id,1)},{default:e(()=>[i("\u540C\u610F\u9000\u6B3E")]),_:2},1032,["onClick"])):E("",!0),o(c).tab==="refunding"?(m(),g(O,{key:2,class:"px-1",type:"primary",size:"small",text:"",onClick:R=>q(a.id,0)},{default:e(()=>[i("\u62D2\u7EDD\u9000\u6B3E")]),_:2},1032,["onClick"])):E("",!0)]),_:1})]),_:1},8,["onSelectionChange","data"])),[[te,o(U)]]),s("div",Te,[t(Q,{background:"",layout:"prev, pager ,next",total:o(b),"current-page":o(k),"page-size":o(x),onCurrentChange:o(h)},null,8,["total","current-page","page-size","onCurrentChange"])])]),_:1}),t(he,{tabs:z,ref_key:"ExportExcelRef",ref:I},null,512),t(Se,{ref_key:"InfoModalRef",ref:y,info:P.value},null,8,["info"])])}}};export{dt as default};
